// buk/server.js

const express = require('express');
const path = require('path');
const cors = require('cors');

app.use(
  cors({
    origin: "http://localhost:5173",
    credentials: true,
  })
);
// 1) Bring in the case-type router you patched in node_modules:
const caseTypeRouter = require('@blaze-case-ai/blaze-engine/server/route/case-type-route');
//const caseTypeRouter = require('./server/route/case-type-route.js');

const app = express();

// 2) Parse JSON bodies
app.use(express.json());

// 3) Mount your API under /api *before* any static or catch-all
app.use("/api", caseTypeRouter);

// 4) Serve your client bundle (if you have one)
app.use(express.static(path.join(__dirname, 'client', 'dist')));

// 5) Catch-all for SPA (but skip /api)
/* app.get('*', (req, res, next) => {
  if (req.path.startsWith('/api/')) return next();   // let /api/* 404 properly
  res.sendFile(path.join(__dirname, 'client', 'dist', 'index.html'));
}); */

app.post('/pong', (req, res) => {
  res.json({ message: 'ping' });
})

// 6) Listen on 8080
const PORT = process.env.PORT || 8081;
app.listen(PORT, () => {
  console.log(`Server up at http://localhost:${PORT}`);
});
