// node_modules/@blaze-case-ai/blaze-engine/server/service/case-type-service.js

const repo = require('@blaze-case-ai/blaze-engine/server/repository/case-type-repository');

// return [{ id, label }, â€¦]
async function fetchCaseTypes() {
  const files = await repo.listFiles();
  return files.map(f => {
    const id = f.replace(/\.js$/, '');
    return { id, label: repo.humanize(id) };
  });
}

// return full data object from the .js file
async function fetchCaseType(caseTypeId) 
{ await repo.ensureCaseTypeDir();
  if (!caseTypeId) throw new Error('Case type ID is required');
  return repo.readCaseType(caseTypeId);
}

// create the file under core/case-type/<id>.js
async function createCaseType(data) {
  const { id, label } = data.caseType;
  console.log(`creating case type ${id} with label ${label}`);
  await repo.ensureCaseTypeDir();
  await repo.writeCaseTypeFile(id, data);
  return { id, label };
}

// overwrite existing
async function updateCaseType(caseTypeId, data) {
  await repo.ensureCaseTypeDir();
  await repo.writeCaseTypeFile(caseTypeId, data);
  return { id: caseTypeId, ...data.caseType };
}

// delete the file
async function deleteCaseType(caseTypeId) {
  await repo.ensureCaseTypeDir();
  await repo.deleteCaseTypeFile(caseTypeId);
}

module.exports = {
  fetchCaseTypes,
  fetchCaseType,
  createCaseType,
  updateCaseType,
  deleteCaseType
};
