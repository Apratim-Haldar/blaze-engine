import './header.js';
import './left-panel.js';
import './center-panel.js';
import './auth-screen.js'; // ðŸ‘ˆ Make sure this import is present

class PortalTemplateComponent extends HTMLElement {
  constructor() {
    super();
    const shadow = this.attachShadow({ mode: 'open' });

    const template = document.createElement('template');
    template.innerHTML = `
      <style>
        .portal-container {
          display: flex;
          flex-direction: column;
          height: 100vh;
        }
        .portal-body {
          display: flex;
          flex: 1;
        }
      </style>
      <div class="portal-container">
        <header-component></header-component>
        <div class="portal-body">
          <left-panel-component></left-panel-component>
          <center-panel-component>
            <slot></slot>
          </center-panel-component>
        </div>
      </div>
    `;
    shadow.appendChild(template.content.cloneNode(true));
  }
}
customElements.define('portal-template-component', PortalTemplateComponent);

// ðŸ‘‡ðŸ‘‡ðŸ‘‡ ADD THIS SECTION BELOW THE CLASS ðŸ‘‡ðŸ‘‡ðŸ‘‡
(async () => {
  const token = localStorage.getItem('blazeToken');

  const valid = await fetch('/auth/verify', {
    headers: { 'Authorization': `Bearer ${token}` }
  }).then(res => res.ok);

  const mount = document.body;
  mount.innerHTML = ''; // Clear any existing content

  if (valid) {
    const portal = document.createElement('portal-template-component');
    mount.appendChild(portal);
  } else {
    const auth = document.createElement('auth-screen');
    mount.appendChild(auth);
  }
})();
