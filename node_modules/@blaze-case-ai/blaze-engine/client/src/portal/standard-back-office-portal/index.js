import './header.js';
import './left-panel.js';
import './center-panel.js';
import './auth-screen.js'; // ðŸ‘ˆ Make sure this import is present

class PortalTemplateComponent extends HTMLElement {
  constructor() {
    super();
    const shadow = this.attachShadow({ mode: 'open' });

    const template = document.createElement('template');
    template.innerHTML = `
      <style>
                :host {
                    display: block;
                    height: 100vh;
                    width: 100vw;
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    background-color: #f9fafb;
                }

                .portal-container {
                    display: flex;
                    height: 100%;
                }

                left-panel-component {
                    width: 240px;
                    min-width: 240px;
                    border-right: 1px solid #e5e7eb;
                    background-color: #ffffff;
                    flex-shrink: 0;
                }

                .main-content-area {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }

                header-component {
                    flex-shrink: 0;
                    display: block;
                }

                center-panel-component {
                    flex: 1;
                    overflow: hidden;
                    display: block;
                }
            </style>

            <div class="portal-container">
                <left-panel-component></left-panel-component>
                <div class="main-content-area">
                    <header-component></header-component>
                    <center-panel-component>
                        <slot></slot>
                    </center-panel-component>
                </div>
            </div>
        `
    shadow.appendChild(template.content.cloneNode(true));
  }
}
customElements.define('portal-template-component', PortalTemplateComponent);

// ðŸ‘‡ðŸ‘‡ðŸ‘‡ ADD THIS SECTION BELOW THE CLASS ðŸ‘‡ðŸ‘‡ðŸ‘‡
(async () => {
  const token = localStorage.getItem('blazeToken');

  const valid = await fetch('/auth/verify', {
    headers: { 'Authorization': `Bearer ${token}` }
  }).then(res => res.ok);

  const mount = document.body;
  mount.innerHTML = ''; // Clear any existing content

  if (valid) {
    const portal = document.createElement('portal-template-component');
    mount.appendChild(portal);
  } else {
    const auth = document.createElement('auth-screen');
    mount.appendChild(auth);
  }
})();
